# -*- coding: utf-8 -*-
"""streamlit_app.py

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1vN7RL0DMo9FdTpa5kOWKdkeYjRufWz23

# **Description (English):**
This is your frontend application, built with the Streamlit library, that users will interact with. It collects input data from users via various UI elements (e.g., select boxes, sliders), sends this data to your deployed FastAPI API, and then displays the predictions and relevant insights.

# **ุงููุตู (ุงูุนุฑุจูุฉ):**
ูุฐุง ูู ุชุทุจูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ ุงูุฐู ุณูุชูุงุนู ูุนู ุงููุณุชุฎุฏูููุ ููู ูุจูู ุจุงุณุชุฎุฏุงู ููุชุจุฉ Streamlit. ูููู ุจุฌูุน ุจูุงูุงุช ุงููุฏุฎูุงุช ูู ุงููุณุชุฎุฏููู ุนุจุฑ ุนูุงุตุฑ ูุงุฌูุฉ ุงููุณุชุฎุฏู ุงููุฎุชููุฉ (ูุซู ุงูููุงุฆู ุงูููุณุฏูุฉุ ุฃุดุฑุทุฉ ุงูุชูุฑูุฑ)ุ ููุฑุณู ูุฐู ุงูุจูุงูุงุช ุฅูู ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช (API) ุงูุชู ููุช ุจูุดุฑูุงุ ุซู ูุนุฑุถ ุงูุชูุจุคุงุช ูุงูุฑุคู ุฐุงุช ุงูุตูุฉ.
"""

# -*- coding: utf-8 -*-
# streamlit_app.py

# --- 1. Import Libraries ---
# streamlit: The main library for building web applications.
# requests: Used to send HTTP requests to your FastAPI backend API.
# time: (Optional) Used for pausing execution, e.g., for a "loading" spinner effect.
import streamlit as st
import requests
import time

# --- 2. Basic Page Configuration ---
# Sets up the general appearance and properties of your Streamlit web page.
# Includes title, icon, layout (wide for more space), and sidebar initial state.
st.set_page_config(
    page_title="ููุตุฉ ุชููุน ูุบุงุฏุฑุฉ ุงูุนููุงุก",
    page_icon="๐",
    layout="wide",
    initial_sidebar_state="expanded"
)

# --- 3. Main User Interface (Frontend) ---
# This section defines the main content and layout of your Streamlit application.
# It includes titles, introductory text, input forms, and prediction display.

# Main title and subtitle of the application
st.title("๐ก ููุตุฉ ุชููุน ูุบุงุฏุฑุฉ ุงูุนููุงุก")
st.markdown("### ุญููู ูุชูุงููุฉ ููุงุญุชูุงุธ ุจุนููุงุฆู ูุชุญููู ุงูููู!")

# Introduction text
st.write("""
ูุฑุญุจูุง ุจู ูู ููุตุฉ Churn Predictor! ููุงุ ูุญูู ุจูุงูุงุช ุนููุงุฆู ุฅูู ุฑุคู ูููุฉ ููุณุงุนุฏุชู ุนูู **ุชููุน ุงูุนููุงุก ุงููุนุฑุถูู ูููุบุงุฏุฑุฉ** ูุจู ููุงุช ุงูุฃูุงู.
ูุญู ูุฏุฑู ุฃู **ุงูุงุญุชูุงุธ ุจุงูุนููุงุก ุฃูู ูู ุงูุชุณุงุจ ุนููุงุก ุฌุฏุฏ**ุ ูุจุฑูุฌูุชูุง ูุตููุฉ ููุฐุง ุงูุบุฑุถ ุชุญุฏูุฏูุง.
""")

st.markdown("---") # Horizontal separator line

# Layout with two columns: left for input form, right for marketing/educational content
col_left, col_right = st.columns([2, 1])

with col_left: # Content for the left column (Data Input Form)
    st.subheader("๐ ุฃุฏุฎู ุชูุงุตูู ุงูุนููู ููุชูุจุค ุจุงููุบุงุฏุฑุฉ")

    # Input elements for customer data:
    # Each st.selectbox, st.slider, st.number_input collects a specific feature from the user.
    # IMPORTANT: Ensure the variable names and expected types match exactly with your CustomerData BaseModel in api_main.py.
    gender = st.selectbox("ุงูุฌูุณ", ["Male", "Female"], help="ุฐูุฑ ุฃู ุฃูุซู.")
    senior_citizen = st.selectbox("ูู ูู ุนููู ูุจูุฑ ูู ุงูุณูุ (65+)", [0, 1], format_func=lambda x: "ูุนู" if x == 1 else "ูุง", help="ุงุฎุชุฑ 1 ุฅุฐุง ูุงู ุงูุนููู ููู 65 ุนุงููุงุ ู 0 ุฅุฐุง ูู ููู ูุฐูู.")
    partner = st.selectbox("ูู ูุฏูู ุดุฑููุ", ["Yes", "No"], help="ูู ุงูุนููู ูุชุฒูุฌ/ูุฏูู ุดุฑููุ")
    dependents = st.selectbox("ูู ูุฏูู ูุนุงูููุ", ["Yes", "No"], help="ูู ุงูุนููู ูุฏูู ุฃุทูุงู ุฃู ูุนุงููู ุขุฎุฑููุ")
    tenure = st.slider("ูุฏุฉ ุจูุงุก ุงูุนููู (ุจุงูุฃุดูุฑ)", 0, 72, 12, help="ูู ุดูุฑูุง ุธู ุงูุนููู ูุดุชุฑููุง ูู ุงูุฎุฏูุฉุ")
    phone_service = st.selectbox("ูู ูุฏูู ุฎุฏูุฉ ูุงุชูุ", ["Yes", "No"], help="ูู ุงูุนููู ูุดุชุฑู ูู ุฎุฏูุฉ ุงููุงุชูุ")
    multiple_lines = st.selectbox("ูู ูุฏูู ุฎุทูุท ูุชุนุฏุฏุฉุ", ["Yes", "No", "No phone service"], help="ุฅุฐุง ูุงู ูุฏูู ุฎุฏูุฉ ูุงุชูุ ูู ูุฏูู ุฎุทูุท ูุชุนุฏุฏุฉุ")
    internet_service = st.selectbox("ููุน ุฎุฏูุฉ ุงูุฅูุชุฑูุช", ["DSL", "Fiber optic", "No"], help="ููุน ุฎุฏูุฉ ุงูุฅูุชุฑูุช ุงููุดุชุฑู ุจูุง ุงูุนููู (ุฃู ูุง ููุฌุฏ).")
    online_security = st.selectbox("ูู ูุฏูู ุฃูุงู ุนุจุฑ ุงูุฅูุชุฑูุชุ", ["Yes", "No", "No internet service"], help="ูู ุงูุนููู ูุดุชุฑู ูู ุฎุฏูุฉ ุงูุฃูุงู ุนุจุฑ ุงูุฅูุชุฑูุชุ")
    online_backup = st.selectbox("ูู ูุฏูู ูุณุฎ ุงุญุชูุงุทู ุนุจุฑ ุงูุฅูุชุฑูุชุ", ["Yes", "No", "No internet service"], help="ูู ุงูุนููู ูุดุชุฑู ูู ุฎุฏูุฉ ุงููุณุฎ ุงูุงุญุชูุงุทู ุนุจุฑ ุงูุฅูุชุฑูุชุ")
    device_protection = st.selectbox("ูู ูุฏูู ุญูุงูุฉ ููุฃุฌูุฒุฉุ", ["Yes", "No", "No internet service"], help="ูู ุงูุนููู ูุดุชุฑู ูู ุฎุฏูุฉ ุญูุงูุฉ ุงูุฃุฌูุฒุฉุ")
    tech_support = st.selectbox("ูู ูุฏูู ุฏุนู ูููุ", ["Yes", "No", "No internet service"], help="ูู ุงูุนููู ูุดุชุฑู ูู ุฎุฏูุฉ ุงูุฏุนู ุงููููุ")
    streaming_tv = st.selectbox("ูู ูุฏูู ุจุซ ุชููุฒููููุ", ["Yes", "No", "No internet service"], help="ูู ุงูุนููู ูุดุชุฑู ูู ุฎุฏูุฉ ุจุซ ุงูุชููุฒูููุ")
    streaming_movies = st.selectbox("ูู ูุฏูู ุจุซ ุฃููุงูุ", ["Yes", "No", "No internet service"], help="ูู ุงูุนููู ูุดุชุฑู ูู ุฎุฏูุฉ ุจุซ ุงูุฃููุงูุ")
    contract = st.selectbox("ููุน ุงูุนูุฏ", ["Month-to-month", "One year", "Two year"], help="ููุน ุงูุนูุฏ ุงูุฐู ููุนู ุงูุนููู (ุดูุฑูุ ุณูุฉุ ุณูุชูู).")
    paperless_billing = st.selectbox("ูุงุชูุฑุฉ ูุง ูุฑููุฉุ", ["Yes", "No"], help="ูู ุงูุนููู ููุนู ุฎุฏูุฉ ุงููุงุชูุฑุฉ ุงูุฅููุชุฑูููุฉุ")
    payment_method = st.selectbox("ุทุฑููุฉ ุงูุฏูุน", ["Electronic check", "Mailed check", "Bank transfer (automatic)", "Credit card (automatic)"], help="ุทุฑููุฉ ุงูุฏูุน ุงูููุถูุฉ ููุนููู.")
    monthly_charges = st.number_input("ุงูุฑุณูู ุงูุดูุฑูุฉ", min_value=0.0, max_value=200.0, value=50.0, help="ุฅุฌูุงูู ุงููุจูุบ ุงูุฐู ูุฏูุนู ุงูุนููู ุดูุฑููุง.")
    total_charges = st.number_input("ุฅุฌูุงูู ุงูุฑุณูู ุงููุฏููุนุฉ", min_value=0.0, max_value=8000.0, value=500.0, help="ุฅุฌูุงูู ุงููุจูุบ ุงูุฐู ุฏูุนู ุงูุนููู ุญุชู ุงูุขู.")

    # Predict Button: This code block runs when the "Predict Churn" button is clicked.
    if st.button("ุชููุน ุงููุบุงุฏุฑุฉ"):
        # Prepare input data as a dictionary, matching the FastAPI CustomerData schema.
        input_data = {
            "gender": gender, "SeniorCitizen": senior_citizen, "Partner": partner,
            "Dependents": dependents, "tenure": tenure, "PhoneService": phone_service,
            "MultipleLines": multiple_lines, "InternetService": internet_service,
            "OnlineSecurity": online_security, "OnlineBackup": online_backup,
            "DeviceProtection": device_protection, "TechSupport": tech_support,
            "StreamingTV": streaming_tv, "StreamingMovies": streaming_movies,
            "Contract": contract, "PaperlessBilling": paperless_billing,
            "PaymentMethod": payment_method, "MonthlyCharges": monthly_charges,
            "TotalCharges": total_charges
        }

        # IMPORTANT: Replace this API URL with your actual deployed FastAPI URL (from Render or Ngrok).
        # This 'localhost' URL will NOT work when deployed!
        api_url = "http://localhost:8000/predict_churn/" # Placeholder! Change this URL!

        try:
            # Display a spinner while waiting for API response
            with st.spinner("ุฌุงุฑู ุงูุชูุจุค..."):
                response = requests.post(api_url, json=input_data, timeout=15) # Send POST request to API

            # Handle API response
            if response.status_code == 200:
                result = response.json()
                churn_prob = result.get("churn_probability", 0) # Get churn probability from response
                st.success(f"**ุงุญุชูุงููุฉ ุงููุบุงุฏุฑุฉ ุงููุชููุนุฉ: {churn_prob:.2f}**")

                # Display recommendations based on churn probability
                if churn_prob > 0.5: # Adjustable threshold for high churn risk
                    st.warning("โ๏ธ ูุฐุง ุงูุนููู **ุนุฑุถุฉ ูููุบุงุฏุฑุฉ!** ูุฑุฌู ุงุชุฎุงุฐ ุฅุฌุฑุงุกุงุช ุงุญุชุฑุงุฒูุฉ ููุฑูุฉ.")
                    st.markdown("""
                    **ุชูุตูุงุช ููุฑูุฉ ูุงุญุชูุงุก ุงููุบุงุฏุฑุฉ:**
                    * **ุงูุนููุงุก ุงููุนุฑุถูู ููุฎุทุฑ (ููุงุท ุฑุฆูุณูุฉ):**
                        * **ูุชุฑุฉ ุงูุจูุงุก ุงููุตูุฑุฉ ูุงูุฑุณูู ุงูุนุงููุฉ:** ูุฏู ููู ุจุฑุงูุฌ ุชุฑุญูุจ ูููุฒุฉ ุฃู ุฎุตููุงุช ุฎุงุตุฉ ูู ุงูุฃุดูุฑ ุงูุฃููู.
                        * **ุบูุงุจ ุงูุฏุนู ุงูููู:** ุนุฑูุถ ุนูู ุฎุฏูุฉ ุงูุฏุนู ุงููููุ ุฃู ุชูุงุตู ุงุณุชุจุงูู ูุญู ุงููุดููุงุช.
                        * **ุนููุฏ ุดูุฑูุฉ:** ุญูุงูุฒ ููุงูุชูุงู ุฅูู ุนููุฏ ุฃุทูู (ุฎุตููุงุชุ ุฎุฏูุงุช ุฅุถุงููุฉ).
                    * **ุงูุฎุทูุฉ ุงูุชุงููุฉ:** ุชูุงุตู ูุจุงุดุฑุฉ ูุน ูุคูุงุก ุงูุนููุงุก ูููู ูุดุงูููู ูุชูุฏูู ุญููู ูุฎุตุตุฉ.
                    """)
                else:
                    st.info("โ ูุฐุง ุงูุนููู **ูู ุงููุฑุฌุญ ุฃู ูุจูู.** ูุง ูุฒุงู ูู ุงูููู ูุฑุงูุจุฉ ุณูููู.")
            else:
                st.error(f"โ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุชูุจุค: {response.status_code} - {response.text}")
                st.info("ุงูุฑุฌุงุก ุงูุชุฃูุฏ ูู ุฃู ุงูู API ููุฏ ุงูุชุดุบูู ูุฃู ุงูุฑุงุจุท ุตุญูุญ (ูุฌุจ ุฃู ูููู ุฑุงุจุท Ngrok ุฃู ุฑุงุจุท ุฎุฏูุฉ ุงููุดุฑ).")
        except requests.exceptions.ConnectionError:
            st.error("โ ูุง ูููู ุงูุงุชุตุงู ุจุฎุงุฏู ุงูู API. ุชุฃูุฏ ูู ุชุดุบูู ุงูู API ุจุดูู ุตุญูุญ ูุฃู ุฑุงุจุทู ูุญุฏุซ.")
        except requests.exceptions.Timeout:
            st.error("โ ุงูุชูุช ูููุฉ ุงูุงุชุตุงู ุจุฎุงุฏู ุงูู API. ูุฏ ูููู ุงูุฎุงุฏู ูุดุบููุงู ุฃู ุงูุฑุงุจุท ุบูุฑ ูุณุชูุฑ. ุงูุฑุฌุงุก ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู.")
        except Exception as e:
            st.error(f"โ ุญุฏุซ ุฎุทุฃ ุบูุฑ ูุชููุน: {e}. ุงูุฑุฌุงุก ุงูุชุญูู ูู ุงููุฏุฎูุงุช ุฃู ุฅุนุฏุงุฏุงุช ุงูู API.")

with col_right: # Content for the right column (Marketing & Educational Info)
    st.subheader("โจ ููุงุฐุง ูุฐู ุงูููุตุฉุ")
    st.markdown("""
    ุชูุนุฏ ูุบุงุฏุฑุฉ ุงูุนููุงุก ุชุญุฏููุง ูุจูุฑูุง ููุดุฑูุงุช. ุชูุฏู ููุตุชูุง ุฅูู ุชุฒููุฏู ุจู **ุฃุฏุงุฉ ูููุฉ ูุฐููุฉ** ุชุณุงุนุฏู ุนูู:

    * **ุชููุน ุงูุนููุงุก ุงููุนุฑุถูู ูููุบุงุฏุฑุฉ:** ุชุนุฑู ุนูู ูู ูุฏ ูุบุงุฏุฑ ูุจู ุฃู ูุญุฏุซ ุฐูู.
    * **ููู ุงูุฃุณุจุงุจ ุงููุงููุฉ:** ููุงุฐุง ูุบุงุฏุฑ ุงูุนููุงุกุ ููุฏู ูู ุฑุคู ุนูููุฉ ูุจููุฉ ุนูู ุงูุฐูุงุก ุงูุงุตุทูุงุนู (ุจุงุณุชุฎุฏุงู **SHAP**) ูููู ุงูุนูุงูู ุงูุฑุฆูุณูุฉ ุงููุคุซุฑุฉ.
    * **ุตูุงุบุฉ ุงุณุชุฑุงุชูุฌูุงุช ูุนุงูุฉ:** ุจูุงุกู ุนูู ุงูุชูุจุคุงุช ูุงูุฑุคูุ ููููู ุงุชุฎุงุฐ ูุฑุงุฑุงุช ูุณุชููุฑุฉ ููุถุน ุฎุทุท ุงุญุชูุงุธ ุจุงูุนููุงุก ูุงุฌุญุฉ.
    """)

    st.markdown("---")

    st.subheader("๐ก ุงูููุงุฆุฏ ุงูุชุฌุงุฑูุฉ ุงูููููุณุฉ:")
    st.markdown("""
    * **ุฒูุงุฏุฉ ุงูุฅูุฑุงุฏุงุช:** ุชูููู ุงููุบุงุฏุฑุฉ ูุนูู ุฒูุงุฏุฉ ูู ูุงุนุฏุฉ ุงูุนููุงุก ุงูุฏุงุฆูุฉ.
    * **ุชูููุฑ ุงูุชูุงููู:** ุชูููุฉ ุงูุชุณุงุจ ุนููู ุฌุฏูุฏ ุฃุนูู ุจูุซูุฑ ูู ุชูููุฉ ุงูุงุญุชูุงุธ ุจุนููู ุญุงูู.
    * **ุชุญุณูู ุฑุถุง ุงูุนููุงุก:** ููู ูุดุงูู ุงูุนููุงุก ูุคุฏู ุฅูู ุชุญุณูู ุงูุฎุฏูุงุช ูุงูููุชุฌุงุช.
    * **ุงุชุฎุงุฐ ูุฑุงุฑุงุช ูุจููุฉ ุนูู ุงูุจูุงูุงุช:** ุจุฏููุง ูู ุงูุชุฎูููุ ุงุนุชูุฏ ุนูู ุชุญููู ุฏููู.
    """)

    st.markdown("---")

    st.subheader("๐ ุฌุฑุจ ูุฌุงููุง!")
    st.markdown("""
    ููุฏู ูู ูุฑุตุฉ ูุชุฌุฑุจุฉ ููุตุชูุง ุจุฃูู ุงูุชุฒุงู:

    * **ุชุฌุฑุจุฉ ูุฌุงููุฉ ูุญุฏูุฏุฉ:** ูู ุจุชุญููู ูุฌููุนุฉ ุตุบูุฑุฉ ูู ุจูุงูุงุช ุนููุงุฆู (ูุซูุงู 100-500 ุณุฌู) ููุญุตูู ุนูู ุชูุฑูุฑ ุฃููู ูุฌุงููุง.
    * **ุญุณุงุจ ุชุฌุฑูุจู (Demo Account):** ุงุณุชูุดู ููุญุฉ ุงููุนูููุงุช ุงูุชูุงุนููุฉ ุจุงุณุชุฎุฏุงู ุจูุงูุงุช ููููุฉ ูุชุฑู ููู ุชุนูู ุงูููุตุฉ ูุชูุงุฑูุฑูุง (ูุซู ุจูุงูุงุช Telco Customer Churn ุงูุชุฌุฑูุจูุฉ).
    * **ุฏุฑุงุณุงุช ุญุงูุฉ:** (ุณูุชู ุฅุถุงูุชูุง ูุฑูุจูุง) ุดุงูุฏ ููู ุณุงุนุฏุช ููุตุชูุง ุดุฑูุงุช ุฃุฎุฑู ุนูู ุชูููู ุงููุบุงุฏุฑุฉ ูุชุญููู ูุชุงุฆุฌ ูุฐููุฉ.
    """)

    st.markdown("---")

    st.subheader("๐ ุงูุฏุนู ูุงูุชุฏุฑูุจ")
    st.markdown("""
    ูุญู ููุง ููุณุงุนุฏุชู ูู ูู ุฎุทูุฉ:
    * **ุงูุฏุนู ุงูููู:** ูุฑูููุง ูุชุงุญ ููุฅุฌุงุจุฉ ุนูู ุฌููุน ุงุณุชูุณุงุฑุงุชู ุญูู ุชูุณูู ุงูุจูุงูุงุช ุฃู ุชูุณูุฑ ุงููุชุงุฆุฌ.
    * **ุงูููุงุฏ ุงูุชุนููููุฉ:** ูููุฑ ููุฏูููุงุช ูุตูุฑุฉ ูุฃุฏูุฉ ุงุณุชุฎุฏุงู ูุจุณุทุฉ ููุณุงุนุฏุชู ุนูู ุชุญููู ุฃูุตู ุงุณุชูุงุฏุฉ ูู ุงูููุตุฉ.
    """)

    st.markdown("---")

    st.subheader("๐ฐ ููุงุฐุฌ ุนูููุง")
    st.markdown("""
    ููุฏู ุญูููุงู ูุฑูุฉ ุชูุงุณุจ ุงุญุชูุงุฌุงุช ุนููู:
    * **ูููุฐุฌ ุงูุงุดุชุฑุงู (SaaS):** ุงุฎุชุฑ ุฎุทุฉ ุดูุฑูุฉ ุฃู ุณูููุฉ ุจูุงุกู ุนูู ุญุฌู ุจูุงูุงุชู ูุงูููุฒุงุช ุงูุชู ุชุญุชุงุฌูุง (ุนุฏุฏ ุงูุนููุงุกุ ุงููุณุชุฎุฏูููุ ุชูุงุฑูุฑ ูุฎุตุตุฉุ ุฏูุฌ ูุน CRM).
        * ูุซุงู: **ุงูุฎุทุฉ ุงูุฃุณุงุณูุฉ:** 50 ุฏููุงุฑูุง ุดูุฑููุง ูู 5000 ุนููู. **ุงูุฎุทุฉ ุงููููุฒุฉ:** 200 ุฏููุงุฑูุง ุดูุฑููุง ูู 50,000 ุนููู + ุชูุตูุงุช ูุฎุตุตุฉ.
    * **ุงูุฏูุน ุญุณุจ ุงูุงุณุชุฎุฏุงู:** ุงุฏูุน ููุท ููุงุจู ุนุฏุฏ ุงูุชูุจุคุงุช ุงูุชู ุชุญุชุงุฌูุง.
    * **ุงูุฎุฏูุงุช ุงูุงุณุชุดุงุฑูุฉ:** ููุฏู ุชุญูููุงุช ูุนููุฉ ููุณุงุนุฏุฉ ูู ุชุทุจูู ุงูุชูุตูุงุช ูุฏูุฌ ุงูุญููู ูุน ุฃูุธูุชู.
    * **ุงูุดุฑุงูุงุช:** ูุชุนุงูู ูุน ุดุฑูุงุช ุงุณุชุดุงุฑูุฉ ูููุฏูู ุญููู ุฃุนูุงู ูุชูุณูุน ูุทุงู ุฎุฏูุงุชูุง.
    """)

# Sidebar content (optional supplementary information)
st.sidebar.title("๐ ุงุจุฏุฃ ุงูุขู!")
st.sidebar.markdown("---")
st.sidebar.info("ุฃุฏุฎู ุชูุงุตูู ุงูุนููู ูู ุงููููุฐุฌ ุงูุฑุฆูุณู ูุงุญุตู ุนูู ุชูุจุค ููุฑู!")
st.sidebar.markdown("---")
st.sidebar.write("ููุงุณุชูุณุงุฑุงุช ุฃู ุงูุฏุนูุ ูุฑุฌู ุงูุชูุงุตู ูุนูุง.")
st.sidebar.markdown("[ุชูุงุตู ูุนูุง](#)") # Placeholder link, replace with actual contact page